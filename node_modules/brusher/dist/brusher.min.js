!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Brusher=t():e.Brusher=t()}(window,function(){return function(e){var t={};function n(a){if(t[a])return t[a].exports;var i=t[a]={i:a,l:!1,exports:{}};return e[a].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:a})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();var r=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.blurryStyleNode=null,this.mouseSteps=[],this.drawBoardCanvas=null,this.drawBoardCanvasContext=null,this.imageCanvas=null,this.imageCanvasContext=null,this.image=null,this.tailAnimationFrame=null,this.options=i({image:null,stroke:80,keepCleared:!1,autoBlur:!1,autoBlurValue:15,lineStyle:"round"},t,{element:"body"}),this.drawTail=this.drawTail.bind(this),this.validateOptions()}return o(e,[{key:"validateOptions",value:function(){if(!this.options.image)throw new Error("Image path to use as brush is required")}},{key:"init",value:function(){e.isCanvasSupported()&&(this.prepareCanvas(),this.bind())}},{key:"bind",value:function(){var e=this;document.addEventListener("mousemove",function(t){t.clientX&&t.clientY&&(e.mouseSteps.unshift(i({time:Date.now()},e.getMousePositionInCanvas(t))),e.drawTail())}),window.addEventListener("resize",function(){e.prepareCanvas()})}},{key:"getMousePositionInCanvas",value:function(e){var t=this.drawBoardCanvas.getBoundingClientRect();return{x:e.clientX-t.left,y:e.clientY-t.top}}},{key:"prepareCanvas",value:function(){this.options.autoBlur&&this.attachBlurryBackground(),this.prepareDrawingCanvas(),this.prepareImageCanvas(),this.loadSelectedImage()}},{key:"attachBlurryBackground",value:function(){if(!this.blurryStyleNode){var e="\n      body { position: relative;  }\n      body:before {\n        background-size: cover;\n        background-position: 0 0;\n        background-attachment: fixed;\n        content: '';\n        background-image: url('"+this.options.image+"');\n        position: fixed;\n        z-index: -1;\n        display: block;\n        width: 100%;\n        height: 100%;\n        -webkit-filter: blur("+this.options.autoBlurValue+"px);\n        filter: blur("+this.options.autoBlurValue+"px); \n        top: 0;\n        left: 0;\n      }\n    ",t=document.createElement("style");t.type="text/css",t.append(document.createTextNode(e)),document.head.appendChild(t),this.blurryStyleNode=t}}},{key:"prepareDrawingCanvas",value:function(){this.drawBoardCanvas&&this.drawBoardCanvas.parentElement&&this.drawBoardCanvas.parentElement.removeChild(this.drawBoardCanvas);var e=this.createCanvasNode();e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.zIndex="-1",this.drawBoardCanvas=e,this.drawBoardCanvasContext=e.getContext("2d"),document.body.appendChild(this.drawBoardCanvas)}},{key:"prepareImageCanvas",value:function(){var e=this.createCanvasNode();this.imageCanvas=e,this.imageCanvasContext=e.getContext("2d"),this.imageCanvasContext.lineCap=this.options.lineStyle,this.imageCanvasContext.shadowBlur=30,this.imageCanvasContext.shadowColor="#000000"}},{key:"loadSelectedImage",value:function(){var e=this;this.image||(this.image=new Image,this.image.addEventListener("load",function(){return e.drawTail()}),this.image.addEventListener("error",function(){return console.error("Failed to load image")}),this.image.src=this.options.image)}},{key:"drawTail",value:function(){this.removeOldSteps(),window.cancelAnimationFrame(this.tailAnimationFrame),this.mouseSteps.length>0&&(this.tailAnimationFrame=window.requestAnimationFrame(this.drawTail)),this.options.keepCleared||this.imageCanvasContext.clearRect(0,0,this.imageCanvas.width,this.imageCanvas.height),this.createStrokeFromSteps();var e=this.drawBoardCanvas.width/this.image.naturalWidth*this.image.naturalHeight,t=this.drawBoardCanvas.width;e<this.drawBoardCanvas.height&&(e=this.drawBoardCanvas.height,t=this.drawBoardCanvas.height/this.image.naturalHeight*this.image.naturalWidth),this.drawBoardCanvasContext.drawImage(this.image,0,0,t,e),this.drawBoardCanvasContext.globalCompositeOperation="destination-in",this.drawBoardCanvasContext.drawImage(this.imageCanvas,0,0),this.drawBoardCanvasContext.globalCompositeOperation="source-over"}},{key:"createStrokeFromSteps",value:function(){for(var e=Date.now(),t=1;t<this.mouseSteps.length;t++){var n=(e-this.mouseSteps[t].time)/1e3,a=Math.max(1-n,0);this.imageCanvasContext.strokeStyle="rgba(0,0,0,"+a+")",this.imageCanvasContext.lineWidth=this.options.stroke,this.imageCanvasContext.beginPath(),this.imageCanvasContext.moveTo(this.mouseSteps[t-1].x,this.mouseSteps[t-1].y),this.imageCanvasContext.lineTo(this.mouseSteps[t].x,this.mouseSteps[t].y),this.imageCanvasContext.stroke()}}},{key:"removeOldSteps",value:function(){for(var e=Date.now(),t=0;t<this.mouseSteps.length;t++)e-this.mouseSteps[t].time>1e3&&(this.mouseSteps.length=t)}},{key:"createCanvasNode",value:function(){var e=this.getElementDimensions(),t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t}},{key:"getElementNode",value:function(){var e=this.options.element;return e&&"object"===(void 0===e?"undefined":a(e))&&"nodeType"in e?e:document.querySelector(e||"body")}},{key:"getElementDimensions",value:function(){return this.getElementNode().getBoundingClientRect()}}],[{key:"isCanvasSupported",value:function(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))}}]),e}();t.default=r,e.exports=t.default},function(e,t,n){e.exports=n(0)}])});
//# sourceMappingURL=brusher.min.js.map